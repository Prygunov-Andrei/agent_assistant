# –°—Ç–∞—Ç—É—Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å OpenAI –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –ö–î

## ‚öôÔ∏è –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: **OpenAI GPT-4o** (–±–µ–∑ fallback –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä)

```yaml
llm:
  use_emulator: false              # OpenAI –≤–∫–ª—é—á–µ–Ω
  fallback_to_emulator: false      # ‚ùå –≠–º—É–ª—è—Ç–æ—Ä –æ—Ç–∫–ª—é—á–µ–Ω –∫–∞–∫ fallback
  model: 'gpt-4o'                  # –ú–æ–¥–µ–ª—å GPT-4o
  temperature: 0.3                 # –ù–∏–∑–∫–∞—è –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å
  max_tokens: 4000                 # –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤
  max_retries: 3                   # –ü–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  timeout: 60                      # –¢–∞–π–º–∞—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
```

---

## üî¥ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å: API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞
API –∫–ª—é—á OpenAI –Ω–µ –ø—Ä–æ—à–µ–ª –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é:
```
Error code: 401 - Incorrect API key provided
```

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–µ–π—á–∞—Å

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –ö–î:
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAI GPT-4o
- ‚ùå OpenAI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 401 (–Ω–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á)
- ‚ùå Fallback –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä **–æ—Ç–∫–ª—é—á–µ–Ω**
- ‚ùå **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ 503 Service Unavailable**

### –û—Ç–≤–µ—Ç API –ø—Ä–∏ –æ—à–∏–±–∫–µ
```json
{
  "error": "OpenAI —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω",
  "details": "OpenAI service is not available. Please configure OPENAI_API_KEY...",
  "processing_time": 0.123,
  "used_emulator": false,
  "suggestion": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ OPENAI_API_KEY –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–ª–∏ –≤–∫–ª—é—á–∏—Ç–µ fallback_to_emulator –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏"
}
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∞–ª–∏–¥–Ω–æ–≥–æ API –∫–ª—é—á–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π OpenAI API –∫–ª—é—á (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π API –∫–ª—é—á:
   - –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ https://platform.openai.com/api-keys
   - –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª—é—á: **Create new secret key**
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑!)

2. –û–±–Ω–æ–≤–∏—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
   ```bash
   OPENAI_API_KEY=sk-proj-–≤–∞—à_–Ω–æ–≤—ã–π_–∫–ª—é—á_–∑–¥–µ—Å—å
   ```

3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend:
   ```bash
   docker-compose restart backend
   ```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
   ```bash
   cd backend
   python3 test_openai_connection.py
   ```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –í–∫–ª—é—á–∏—Ç—å —ç–º—É–ª—è—Ç–æ—Ä –∫–∞–∫ fallback (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ OpenAI —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞ —ç–º—É–ª—è—Ç–æ—Ä:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `backend/llm_config.yaml`
2. –ò–∑–º–µ–Ω–∏—Ç–µ:
   ```yaml
   llm:
     use_emulator: false
     fallback_to_emulator: true  # ‚Üê –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ true
   ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

‚ö†Ô∏è **–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –≠–º—É–ª—è—Ç–æ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç **—Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**, –Ω–µ —Ä–µ–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —ç–º—É–ª—è—Ç–æ—Ä (–±–µ–∑ OpenAI)

–î–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–µ–∑ OpenAI:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `backend/llm_config.yaml`
2. –ò–∑–º–µ–Ω–∏—Ç–µ:
   ```yaml
   llm:
     use_emulator: true  # ‚Üê –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ true
     fallback_to_emulator: false
   ```
3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

---

## üéØ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –°—Ö–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ –æ—Ç –ö–î

```
–ó–∞–ø—Ä–æ—Å –æ—Ç –ö–î ‚Üí API endpoint (/api/requests/{id}/analyze/)
                    ‚Üì
             LLMService.analyze_request()
                    ‚Üì
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚Üì                       ‚Üì
  OpenAI –¥–æ—Å—Ç—É–ø–µ–Ω?        OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
        ‚Üì                       ‚Üì
  GPT-4o –∞–Ω–∞–ª–∏–∑          fallback_to_emulator?
        ‚Üì                 ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
   ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç      –î–∞ ‚Üì         ‚Üì –ù–µ—Ç
                  –≠–º—É–ª—è—Ç–æ—Ä    ‚ùå –û—à–∏–±–∫–∞ 503
                       ‚Üì
                  ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç
```

### –ß—Ç–æ –∏–∑–≤–ª–µ–∫–∞–µ—Ç GPT-4o –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –ö–î

‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ:**
- –ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
- –¢–∏–ø (–§–∏–ª—å–º, –°–µ—Ä–∏–∞–ª, –†–µ–∫–ª–∞–º–∞, –ö–ª–∏–ø –∏ —Ç.–¥.)
- –ñ–∞–Ω—Ä
- –û–ø–∏—Å–∞–Ω–∏–µ
- –î–∞—Ç–∞ –ø—Ä–µ–º—å–µ—Ä—ã

‚úÖ **–†–æ–ª–∏ –¥–ª—è –∫–∞—Å—Ç–∏–Ω–≥–∞:**
- –ù–∞–∑–≤–∞–Ω–∏–µ —Ä–æ–ª–∏ / –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
- –û–ø–∏—Å–∞–Ω–∏–µ —Ä–æ–ª–∏
- –í–æ–∑—Ä–∞—Å—Ç (–¥–∏–∞–ø–∞–∑–æ–Ω)
- –ü–æ–ª
- –í–Ω–µ—à–Ω–æ—Å—Ç—å (—Ä–æ—Å—Ç, —Ç–µ–ª–æ—Å–ª–æ–∂–µ–Ω–∏–µ, —Ü–≤–µ—Ç –≤–æ–ª–æ—Å/–≥–ª–∞–∑)
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –Ω–∞–≤—ã–∫–∞–º
- –ì–æ–Ω–æ—Ä–∞—Ä
- –î–∞—Ç—ã –∏ –ª–æ–∫–∞—Ü–∏—è —Å—ä–µ–º–æ–∫

‚úÖ **–ö–æ–Ω—Ç–∞–∫—Ç—ã –∫–æ–º–∞–Ω–¥—ã:**
- –ö–∞—Å—Ç–∏–Ω–≥-–¥–∏—Ä–µ–∫—Ç–æ—Ä
- –†–µ–∂–∏—Å—Å–µ—Ä
- –ü—Ä–æ–¥—é—Å–µ—Ä—ã
- –ü—Ä–æ–¥—é—Å–µ—Ä—Å–∫–∞—è –∫–æ–º–ø–∞–Ω–∏—è

---

## üìä –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ OpenAI
```bash
cd /Users/andrei_prygunov/Dev/agent_assistant/backend
python3 test_openai_connection.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª—é—á–∞):**
```
‚úÖ API –∫–ª—é—á –Ω–∞–π–¥–µ–Ω
‚úÖ OpenAI —Å–µ—Ä–≤–∏—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ OpenAI API —É—Å–ø–µ—à–Ω–æ!
‚úÖ –ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
cd /Users/andrei_prygunov/Dev/agent_assistant/backend
python3 test_emulator_mode.py
```

### –¢–µ—Å—Ç 3: API –∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ curl
```bash
curl -X POST http://localhost:8000/api/requests/1/analyze/ \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"use_emulator": false}'
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç (200 OK):**
```json
{
  "project_analysis": {
    "project_title": "–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞",
    "project_type": "–§–∏–ª—å–º",
    "genre": "–î—Ä–∞–º–∞",
    "roles": [...]
  },
  "contacts": {...},
  "confidence": 0.85,
  "processing_time": 2.45,
  "used_emulator": false
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ (503 Service Unavailable):**
```json
{
  "error": "OpenAI —Å–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω",
  "details": "...",
  "processing_time": 0.123,
  "used_emulator": false,
  "suggestion": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ OPENAI_API_KEY..."
}
```

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### 1. llm_config.yaml
–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `fallback_to_emulator` –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è fallback –ª–æ–≥–∏–∫–∏.

### 2. llm/services.py - LLMService.analyze_request()
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫—É `fallback_to_emulator`
- –ü—Ä–∏ `fallback_to_emulator: false` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç–º—É–ª—è—Ç–æ—Ä–∞
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É `ValueError` –µ—Å–ª–∏ OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

### 3. llm/views.py - analyze_request()
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ `ValueError` (OpenAI –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω)
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP 503 –≤–º–µ—Å—Ç–æ 500 –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `suggestion` —Å –ø–æ–¥—Å–∫–∞–∑–∫–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ `used_emulator` –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è production
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞–ª–∏–¥–Ω—ã–π OpenAI API –∫–ª—é—á
- ‚úÖ `use_emulator: false`
- ‚úÖ `fallback_to_emulator: false` (—Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ 503

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å `fallback_to_emulator: true`
- ‚úÖ –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–∞–∂–µ –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å OpenAI

### –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ `use_emulator: true` - —Ä–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —Å —ç–º—É–ª—è—Ç–æ—Ä–æ–º
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç API –∫–ª—é—á–∞
- ‚úÖ –ú–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 10 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** –≠–º—É–ª—è—Ç–æ—Ä –æ—Ç–∫–ª—é—á–µ–Ω, —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–π API –∫–ª—é—á OpenAI

