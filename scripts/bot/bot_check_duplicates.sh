#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Telegram –±–æ—Ç–∞
# –ü–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å Telegram API (–æ–¥–∏–Ω —Ç–æ–∫–µ–Ω = –æ–¥–∏–Ω –∞–∫—Ç–∏–≤–Ω—ã–π –±–æ—Ç)

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ Telegram –±–æ—Ç–∞..."
echo "========================================"
echo ""

# –ò—â–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å telegram –≤ –∏–º–µ–Ω–∏
BOTS=$(docker ps -a --filter "name=telegram" --format "{{.Names}}\t{{.Status}}")

if [ -z "$BOTS" ]; then
    echo "‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –±–æ—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
    exit 0
fi

echo "üìã –ù–∞–π–¥–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –±–æ—Ç–∞:"
echo "$BOTS"
echo ""

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –±–æ—Ç—ã
RUNNING=$(docker ps --filter "name=telegram" --format "{{.Names}}")

if [ -z "$RUNNING" ]; then
    echo "‚úÖ –ó–∞–ø—É—â–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤ –Ω–µ—Ç"
    exit 0
fi

# –°—á–∏—Ç–∞–µ–º –∑–∞–ø—É—â–µ–Ω–Ω—ã–µ –±–æ—Ç—ã
COUNT=$(echo "$RUNNING" | wc -l | tr -d ' ')

if [ "$COUNT" -gt 1 ]; then
    echo "‚ö†Ô∏è  ‚ö†Ô∏è  ‚ö†Ô∏è  –í–ù–ò–ú–ê–ù–ò–ï! ‚ö†Ô∏è  ‚ö†Ô∏è  ‚ö†Ô∏è"
    echo ""
    echo "–ù–∞–π–¥–µ–Ω–æ $COUNT –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –±–æ—Ç–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ!"
    echo ""
    echo "–ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –±–æ—Ç—ã:"
    echo "$RUNNING"
    echo ""
    echo "‚ö†Ô∏è  –≠—Ç–æ –≤—ã–∑–æ–≤–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å Telegram API!"
    echo "Telegram –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –û–î–ò–ù –∞–∫—Ç–∏–≤–Ω—ã–π –±–æ—Ç –Ω–∞ —Ç–æ–∫–µ–Ω."
    echo ""
    echo "–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏—à–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã."
    echo ""
    read -p "–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –í–°–ï –±–æ—Ç—ã —Å–µ–π—á–∞—Å? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        echo "–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –±–æ—Ç—ã..."
        docker stop $(docker ps -q --filter "name=telegram") 2>/dev/null
        docker rm $(docker ps -aq --filter "name=telegram") 2>/dev/null
        echo "‚úÖ –í—Å–µ –±–æ—Ç—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —É–¥–∞–ª–µ–Ω—ã"
        echo ""
        echo "üí° –¢–µ–ø–µ—Ä—å –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω—É–∂–Ω–æ–≥–æ –±–æ—Ç–∞:"
        echo "   –î–ª—è DEV:        ./scripts/bot/bot_dev_toggle.sh"
        echo "   –î–ª—è PRODUCTION: —Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é"
    else
        echo "‚ö†Ô∏è  –û—Å—Ç–∞–≤–ª—è–µ–º –±–æ—Ç—ã –∫–∞–∫ –µ—Å—Ç—å"
        echo "–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω!"
    fi
elif [ "$COUNT" -eq 1 ]; then
    echo "‚úÖ –ó–∞–ø—É—â–µ–Ω 1 –±–æ—Ç (–Ω–æ—Ä–º–∞–ª—å–Ω–æ):"
    echo "   $RUNNING"
    echo ""
    echo "üìã –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤:"
    echo "   docker logs -f $RUNNING"
else
    echo "‚úÖ –î—É–±–ª–∏–∫–∞—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
fi

echo ""
echo "üí° –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–æ–º –≤ DEV —Ä–µ–∂–∏–º–µ:"
echo "   ./scripts/bot/bot_dev_toggle.sh"

